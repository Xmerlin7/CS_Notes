# Explanation 
- With 32-bit addressing, the [[Cortex-M3 & Cortex-M4 Processors]] can access up to 4GB of memory space.
- The 4GB memory space is divided into a number of regions for various predefined memory and peripheral uses. 
- This allows the processor design to be optimized for performance.
- When a write transfer to a bufferable memory region will take multiple cycles, the transfer can be buffered by the internal write buffer in the Cortex-M3 or Cortex-M4 processor so that the processor can continue to execute the next instruction, if possible. 
- This allows higher program execution speed.
- All processors supporting ARMv7-M architecture support unaligned data transfers.
- #### Memory map ^4ea034
	- The partitioning of the 4GB address space is based on typical usages so that different areas are designed to be used primarily for:
		- Program code accesses (e.g., CODE region)
		- Data accesses (e.g., SRAM region)
		- Peripherals (e.g., Peripheral region)
		- Processor’s internal control and debug components (e.g., Private Peripheral Bus)
	- Different microcontrollers have different memory sizes and peripheral address locations. 
	- This information is usually outlined in user manuals or datasheets from microcontroller vendors.
	 ![[Memory map.png]]
- #### Stack Memory
	- Stack is a kind of memory usage mechanism that allows a portion of memory to be used as Last-In-First-Out data storage buffer.
	- The Cortex-M processors use a stack memory model called “full-descending stack.” When the processor is started, the SP is set to the end of the memory space reserved for stack memory.
	- Since the registers in the register bank are 32 bits, each memory transfer generated by stack PUSH and stack POP transfers at least 1 word (4 bytes) of data, and the addresses are always aligned to 4-byte boundaries. 
	- The lowest two bits of the SP are always zero.
	- Note that the automatic “Stacking” and “Unstacking” stages use [[Programmer’s model#^5b7e73|Process Stack Pointer]].
	- Although only one of the SPs is visible at a time, it is possible to read/write directly to the MSP and PSP, without any confusion over which [[Programmer’s model#^574a6d|SP/R13]] you are referring to.
	- To access MSP and PSP in assembly code, you can use the MSR and MRS instructions:
		- `MRS R0, MSP ; Read Main Stack Pointer to R0`
		- `MSR MSP, R0 ; Write R0 to Main Stack Pointer`
		- `MRS R0, PSP ; Read Process Stack Pointer to R0`
		- `MSR PSP, R0 ; Write R0 to Main Stack Pointer`
	- After power up, the processor hardware automatically initializes the MSP by reading the vector table.
	- The PSP is not initialized automatically and must be initialized by the software before being used.
# Sources
- The Definitive Guide to ARM Cortex-M3 and Cortex-M4 Processors 4.4
- **Memory Map**
- 13_Introduction To ARM Architecture Part13.
- 14_Introduction To ARM Architecture Part14.
- 15_Introduction To ARM Architecture Part15.
___
- **Stack Memory**
- 22_Introduction To ARM Architecture Part22.
- 23_Introduction To ARM Architecture Part23.
- 24_Introduction To ARM Architecture Part24.